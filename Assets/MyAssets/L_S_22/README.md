<!-- 码云挂件,在码云、Typora下style无效 -->
<div style="position: absolute; right: 0 ;top: 0; opacity: 70%;">

</div>

# Shader的深度缓冲区

## 什么是深度缓冲区
深度缓冲区是和颜色缓冲区、模板缓冲区平行的一个缓冲区

    深度缓冲区：顾名思义存放的是代表模型深度的值的一个缓冲区
    而这个值是由模型顶点的 z 值转化得到一个介于 0 和 1 之间的一个值

## 什么是深度信息

从3D投影为2D，变换后的Z值就成了深度信息  
每个顶点的深度信息，在光栅化阶段会被差值，并写入到深度缓冲中（前提开启了深度写入）

## 深度缓冲区的作用

图片：01  
用01图做例子：
图中的 圆 在 三角形前面
在渲染时，先渲染圆，后渲染三角形
如果不用 深度缓冲区控制是否渲染的话
三角形被遮盖的部分 还是会被绘制一遍，比较消耗性能
这时，我们就可以使用深度缓冲区取消被遮盖区域的绘制
但是，对于半透明的物体，一般不启用深度缓冲区
因为虽然被遮挡了，但是效果需要通过前面的物体，看见后面的物体

# Shader的深度写入ZWrite

## 深度值的写入操作
只有两个选择 开启 和 关闭

    ZWrite On — 写入（默认不写时是开启）
    ZWrite Off — 不写入
1、特效一般都需要关闭深度写入
2、如果在人物模型上使用 特效半透明 的 Shader，为了不出现模型自身穿透问题，则需要 在一个单独的 Pass 中开启深度写入  

在单独的Pass中开启深度写入的效果（缺点：多使用了一个Pass，比较消耗性能）：

    Pass
    {
    ZWrite On
    //不输出任何颜色通道（不做设置会输出白色）
    ColorMask 0
    }
## 使用开关，来让材质球单独控制深度写入，而不在Shader中统一控制

    //是否开启深度写入
    [Enum(off,0,on,1)]_ZWrite(“ZWrite”,int) = 0

# Shader的深度测试ZTest
## 一、深度测试是干什么的

通俗的讲，深度测试就是颜色在写入颜色缓冲区前，对其做出一些判断
通过测试的加入颜色缓冲区，没有通过测试的就舍弃

## 二、图示讲解深度测试的作用

图02
图中
蓝色矩形先渲染
红色矩形后渲染
渲染测试采用默认的小于等于
深度测试蓝色矩形时，深度值 0.4 < 1,通过测试，全部部分加入 颜色缓冲区
深度测试红色矩形时，深度值 0.6 只有小于 1 的部分通过测试, 大于 0.4 的部分不通过测试
所以，最后的效果呈现 蓝色矩形 在 红色矩形前

## 深度值的测试操作

ZTest(Less | LEqual | GEqual | Equal | NotEqual | Never | Always)
### 使用开关控制是否开启深度测试

    Unity封装好的枚举方法：UnityEngine.Rendering.CompareFunction

    属性面板：[Enum(UnityEngine.Rendering.CompareFunction)]_ZTest(“ZTest”,int) = 0

    SubShader: ZTest [_ZTest]

最终代码：L_S_22_b